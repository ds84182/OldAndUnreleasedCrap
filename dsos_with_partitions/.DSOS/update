local args = {...}
local version = args[1]
local parentdir = "https://raw.github.com/ds84182/DSOS/master/"
local vdath = http.get(parentdir.."versiondata/version")
local vdatnum = tonumber(vdath.readAll())
vdath.close()
if vdatnum > version then
	--Start updating--
	--Find the files that need to be updated by looking in versiondata/changed--
	term.clear()
	local w,h  = term.getSize()
	if term.isColor() then
		term.setBackgroundColor(0x80)
		for y=2, h-2 do
			term.setCursorPos(1,y)
			term.clearLine()
		end
	end
	term.setCursorPos(1,math.floor((h-2)/2)+1)
	term.write("Updating... Please Wait...")
	
	local webfh = http.get(parentdir.."install")
	local code = webfh.readAll()
	webfh.close()
	
	--Now, get all HDD.nfs contents
	local fh = fs.open(".DSOS/part/HDD.nfs","r")
	local hdd_dat = fh.readAll()
	fh.close()
	
	--Delete .DSOS, boot_DSOS.bin, and os.lst--
	fs.delete("/.DSOS")
	fs.delete("boot_DSOS.bin")
	fs.delete("os.lst")
	
	--Run updater--
	loadstring(code)()
	
	--Rewrite HDD.nfs--
	local fh = fs.open(".DSOS/part/HDD.nfs","w")
	fh.write(hdd_dat)
	fh.close()
	
	term.setCursorPos(1,math.floor((h-2)/2)+1)
	term.clearLine()
	term.write("Finished Updating!")
	sleep(1/2)
	os.reboot()
	coroutine.yield()
end